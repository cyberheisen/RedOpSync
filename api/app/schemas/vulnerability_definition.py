from datetime import datetime
from uuid import UUID
from typing import Literal

from pydantic import BaseModel, Field


SEVERITY_VALUES = ("Critical", "High", "Medium", "Low", "Info")


class VulnerabilityDefinitionCreate(BaseModel):
    project_id: UUID
    host_id: UUID
    port_id: UUID | None = None
    subnet_ids: list[UUID] = Field(default_factory=list, max_length=50)
    title: str = Field(..., min_length=1, max_length=512)
    description_md: str | None = None
    evidence_md: str | None = None
    severity: str | None = Field(None, max_length=32)
    cvss_score: int | None = Field(None, ge=0, le=10)
    cve_ids: list[str] = Field(default_factory=list, max_length=50)


class VulnerabilityDefinitionUpdate(BaseModel):
    title: str | None = Field(None, min_length=1, max_length=512)
    subnet_ids: list[UUID] | None = None
    description_md: str | None = None
    evidence_md: str | None = None
    severity: str | None = Field(None, max_length=32)
    cvss_score: int | None = Field(None, ge=0, le=10)
    cve_ids: list[str] | None = None


class VulnerabilityDefinitionRead(BaseModel):
    id: UUID
    project_id: UUID
    title: str
    description_md: str | None
    evidence_md: str | None
    severity: str | None
    cvss_score: int | None
    cve_ids: list[str] | None
    discovered_by: str | None
    created_at: datetime
    updated_at: datetime

    model_config = {"from_attributes": True}


class VulnerabilityDefinitionWithInstances(VulnerabilityDefinitionRead):
    instance_count: int = 0
    affected_host_ids: list[UUID] = Field(default_factory=list)
    affected_subnet_ids: list[UUID] = Field(default_factory=list)


class AffectedHostsUpdate(BaseModel):
    host_ids: list[UUID] = Field(..., max_length=500)


class AffectedSubnetsUpdate(BaseModel):
    subnet_ids: list[UUID] = Field(..., max_length=100)
